<% layout("../layout/layout") %> 
 <!-- content -->
 <section class="sm-container">
    <div class="row my-sm-5 mx-auto justify-content-center">
        <!-- sign up -->
        <div class="col-lg-4 col-sm-7 col">
            <div class="bg-primary row">
                <p class="h1 text-success text-center my-4">忘記密碼</p>
                <form id="sendEmail">
                    <div class="row px-4">
                        <div class="input-group mb-3">
                            <label for="emailMd" class=" p-4 rounded-0 input-group-text bg-success email-input-icon"><i class="fas fa-user"></i></label>
                            <input name="email" id="emailMd" placeholder="請輸入註冊之信箱" type="email" class="rounded-0 form-control input-style" required>
                        </div>
                        <div class="email error text-info"></div>
                    </div>
                    <!-- recaptcha -->
                    <div class="row">
                        <button type="submit" class="g-recaptcha btn btn-info text-primary fs-4 fw-bold rounded-0 py-3" data-sitekey="6LcOLOogAAAAAHI01G40FhSR6eHsej4-bIioLUKP" data-callback="onSubmit">發送驗證信</button>
                    </div>
                </form>
            </div>
        </div>
       
    </div>
</section>

<script>
    const form = document.querySelector('form');
    const emailError = document.querySelector('.email.error');
    
    form.addEventListener('submit', async (e)=>{
        e.preventDefault();

        // reset errors
        emailError.textContent = "";
       
        // get the values
        let email = form.email.value;
       
        try{
            const res = await fetch('/',{
                method:'POST',
                body: JSON.stringify({email}),
                headers:{ 'Content-Type': 'application/json'}
            });
            // error message
            const data = await res.json();
            // console.log(data);
            if(data.errors){
                emailError.textContent = data.errors.email;
            }
            if(data.user){
                location.assign('/forgot');
            }
        }
        catch(err){
            console.log(err);
        }
    })
</script>